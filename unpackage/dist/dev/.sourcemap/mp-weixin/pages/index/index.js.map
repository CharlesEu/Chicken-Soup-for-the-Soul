{"version":3,"file":"index.js","sources":["pages/index/index.vue","../前端资料/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<!-- 入口组件  首页页面-->\n<template>\n\t<view class=\"homeLayout\">\n\t\t<view class=\"head\">\n\t\t\t<home-head></home-head>\n\t\t</view>\n\t\t\n\t\t<view class=\"body\">\n\t\t\t<view class=\"swiperOut\">\n\t\t\t\t<!-- 如果没有数据 -->\n\t\t\t\t<view class=\"noData\" v-if=\"!listData.length\"> \n\t\t\t\t\t<uni-load-more status=\"loading\" :showText=\"false\"></uni-load-more>\n\t\t\t\t</view>\n\t\t\t\t<swiper vertical @change=\"swiperChange\" :duration=\"260\" v-else>\n\t\t\t\t\t<swiper-item v-for=\"(item,index) in listData\" :key=\"index\">\n\t\t\t\t\t\t<navigator :url=\"`/pages/detail/detail?id=${item._id}`\" class=\"content\">\n\t\t\t\t\t\t\t<soup-tab-group :type=\"item.soup_type\"></soup-tab-group>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<soup-text-content maxline=\"5\" :item=\"item\"></soup-text-content>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</navigator>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t<interactive-bar :item=\"item\" @share=\"clickShare(index)\"></interactive-bar>\n\t\t\t\t\t</swiper-item>\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<swiper-item class=\"ad\">\n\t\t\t\t\t\t<view class=\"message\">\n\t\t\t\t\t\t\t<view class=\"title\">小主，今日鸡汤已干完！</view>\n\t\t\t\t\t\t\t<text class=\"des\">每日5碗鸡汤，如果想要加餐，\\n点击下方看广告按钮，可继续推送5碗，\\n每日最多加餐5次。</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"btnGroup\">\n\t\t\t\t\t\t\t<view class=\"btn\" @click=\"clickAdSoup\">看广告刷新</view>\n\t\t\t\t\t\t\t<view class=\"text\">今日还有{{readNumber}}次机会</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</swiper-item>\n\t\t\t\t\t\n\t\t\t\t</swiper>\n\t\t\t</view>\n\t\t\t<view class=\"progress\">\n\t\t\t\t<view class=\"line\" :style=\"{width:lineWidth+'%'}\"></view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<uni-popup ref=\"usePopup\" type=\"center\" @maskClick=\"closeUsePopup\" \n\t\t@touchmove=\"closeUsePopup\">\n\t\t\t<view class=\"usePopup\">\n\t\t\t\t<image src=\"../../static/images/upward.png\" mode=\"heightFix\" @click=\"closeUsePopup\"></image>\n\t\t\t</view>\n\t\t</uni-popup>\n\t\t\n\t\t<share-posters ref=\"shareRef\" :info=\"shareInfo\"></share-posters>\n\t</view>\n</template>\n\n<script setup>\nimport { computed, ref } from 'vue';\nimport {onReady} from \"@dcloudio/uni-app\"\nimport {useCounterStore} from \"@/stores/counter.js\";\nimport { showToast } from '../../utils/common';\nconst counterStore = useCounterStore()\nconst listData = ref([]);\nconst currentIndex = ref(0);\nconst usePopup =ref(null);\nconst db = uniCloud.database();\nconst dbCmd = db.command;\nconst $ = dbCmd.aggregate;\nconst currentUser = uniCloud.getCurrentUserInfo().uid\nconst readNumber = ref(5);\nconst shareRef = ref(null)\nconst shareInfo = ref(null);\nonReady(()=>{\n\tlet useState = uni.getStorageSync(\"useState\") || false;\n\tif(!useState) usePopup.value.open();\n\t\n})\n\n\nconst clickShare =(index)=>{\n\tshareInfo.value = listData.value[index]\n\tshareRef.value.handleShow();\n}\n\n\nuni.$on('like',(e)=>{\n\tconsole.log(e);\n\tlet index = listData.value.findIndex(item=>item._id == e._id);\n\tlistData.value[index] = {\n\t\t...listData.value[index],\n\t\t...e\n\t}\t\n\tdb.collection(\"soup-today\").where(`user_id == $cloudEnv_uid`).update({\n\t\tsoup_list:listData.value\n\t})\n})\n\n\n\n//点击广告获取新鸡汤\nconst clickAdSoup = async ()=>{\n\tuni.showLoading({\n\t\ttitle:\"加载中...\"\n\t})\n\t// 用户触发广告后，显示激励视频广告\n\tif (videoAd) {\n\t  videoAd.show().catch(() => {\n\t\tuni.hideLoading();\n\t    // 失败重试\n\t    videoAd.load()\n\t      .then(() => videoAd.show())\n\t      .catch(err => {\n\t        console.error('激励视频 广告显示失败', err)\n\t      })\n\t  })\n\t}\t\n}\n\n\n\n\n//获取鸡汤\nconst getSoup =async (type='get')=>{\n   // 添加加载状态\n   uni.showLoading({\n       title:\"加载中...\"\n   });\n   \n   try {\n       //查询soup-today表，有无当前用户进入的记录\n       let {result:{data:todayData=[],errCode=-1}={}} =await db.collection(\"soup-today\").where(`user_id == $cloudEnv_uid`).get();\n       \n       //存在today记录，就获取today的鸡汤\n       if(todayData.length && type=='get'){\n           if(errCode!=0) {\n               uni.hideLoading();\n               return showToast(\"信息有误，请重新刷新\",\"none\");\n           }\n           // 直接赋值，避免重复添加\n           listData.value = todayData[0].soup_list;\n           readNumber.value = todayData[0].number;\n       } else {\n           //不存在则执行查询soup-chicken中满足要求的鸡汤\n           let {result:{errCode,data}}= await db.collection(\"soup-chicken\").aggregate()  \n           // ... 现有代码 ...\n           \n           if(errCode!=0) {\n               uni.hideLoading();\n               return showToast(\"信息有误，请重新刷新\",\"none\");\n           }\n           \n           if(data.length==0) {\n               uni.hideLoading();\n               return getSoup(\"random\");\n           }\n           \n           data[0].is_read = true;\n           // 对于新数据，直接赋值而不是追加\n           if(type=='ad') {\n               // 广告刷新时，追加新数据\n               listData.value = [...listData.value, ...data];\n               db.collection(\"soup-today\").where(`user_id == \"${currentUser}\"`).update({\n                   soup_list:listData.value\n               });\n           } else {\n               // 首次加载时，直接赋值\n               listData.value = data;\n               db.collection(\"soup-today\").add({\n                   user_id:currentUser,\n                   soup_list:data\n               });\n           }\n       }\n   } catch (error) {\n       console.error(\"获取鸡汤数据失败:\", error);\n       showToast(\"获取数据失败，请重试\",\"none\");\n   } finally {\n       uni.hideLoading();\n   }\n   \n   // 打印检查获取到的数据\n   console.log(\"获取到的鸡汤数据:\", listData.value);\n}\n\n\n\ngetSoup()\n\n//轮播切换事件\nconst swiperChange = (e)=>{\t\n\tcurrentIndex.value = e.detail.current\n\tif(listData.value[currentIndex.value] && !listData.value[currentIndex.value].is_read){\n\t\tlistData.value[currentIndex.value].is_read = true;\t\n\t\tdb.collection(\"soup-today\").where(`user_id == $cloudEnv_uid`).update({\n\t\t\tsoup_list:listData.value\n\t\t}).then(res=>{\n\t\t\tconsole.log(res);\n\t\t})\n\t}else{\n\t\tconsole.log(\"重复操作\");\n\t}\n}\n\n//进度条的宽度\nconst lineWidth = computed(()=>currentIndex.value/listData.value.length*100)\n\n\n//点击操作的遮罩层\nconst closeUsePopup = ()=>{\n\tusePopup.value.close();\n\tuni.setStorageSync(\"useState\",true);\n}\n\n\n// 若在开发者工具中无法预览广告，请切换开发者工具中的基础库版本\n// 在页面中定义激励视频广告\nlet videoAd = null\n\n// 在页面onLoad回调事件中创建激励视频广告实例\nif (wx.createRewardedVideoAd) {\n  uni.hideLoading();\n  videoAd = wx.createRewardedVideoAd({\n    adUnitId: 'adunit-c2d6709878b96f75'\n  })\n  videoAd.onLoad(() => {})\n  videoAd.onError((err) => {\n    console.error('激励视频光告加载失败', err)\n  })\n  videoAd.onClose((res) => {\n\t  uni.showLoading({\n\t  \ttitle:\"加载中...\"\n\t  })\n\t  if(res.isEnded){\n\t\t  adClose();\n\t  }else{\n\t\t  showToast(\"广告没有播放完毕\");\n\t  }\n  })\n}\n\n\nconst  adClose =async ()=>{\t\n\tif(readNumber.value<=0) return showToast('今日份鸡汤已全部喝光~')\n\treadNumber.value--\n\tlet res = await db.collection(\"soup-today\").where(`user_id == \"${currentUser}\"`).update({\n\t\tnumber:readNumber.value\n\t})\n\tgetSoup('ad')\n}\n\n\n\n\n</script>\n\n<style lang=\"scss\" scoped>\n.homeLayout{\n\theight: 100vh;\n\tbackground: #BDE1FB;\n\tdisplay: flex;\n\tflex-direction: column;\n\t.head{\n\t\t\n\t}\n\t.body{\n\t\tflex:1;\n\t\tbackground: #fff;\n\t\tborder-radius: 50rpx 50rpx 0 0;\n\t\toverflow: hidden;\n\t\t.swiperOut{\n\t\t\theight: calc(100% - 8rpx);\n\t\t\t.noData{\t\t\t\t\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t}\n\t\t\tswiper{\n\t\t\t\theight: 100%;\n\t\t\t\t&-item{\n\t\t\t\t\t.content{\n\t\t\t\t\t\theight: calc(100% - 130rpx);\t\t\t\t\t\t\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\tpadding:0 30rpx;\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.ad{\n\t\t\t\t\tbackground: #F8F8F8;\t\n\t\t\t\t\tpadding:100rpx 30rpx;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\t.message{\n\t\t\t\t\t\tbackground: #fff;\n\t\t\t\t\t\tborder-radius: 30rpx;\n\t\t\t\t\t\tpadding:40rpx;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.title{\n\t\t\t\t\t\t\tfont-size: 46rpx;\n\t\t\t\t\t\t\tpadding-bottom:20rpx;\n\t\t\t\t\t\t\tborder-bottom:1px solid #eee;\n\t\t\t\t\t\t\tmargin-bottom: 20rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.des{\n\t\t\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\t\t\tcolor:#555;\n\t\t\t\t\t\t\tline-height: 1.8em;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.btnGroup{\n\t\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t\t\t.btn{\n\t\t\t\t\t\t\twidth: 400rpx;\n\t\t\t\t\t\t\theight: 100rpx;\n\t\t\t\t\t\t\tborder-radius: 100rpx;\n\t\t\t\t\t\t\tbackground: linear-gradient(to top,#93c4ff,#b1e1ff);\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tfont-size: 38rpx;\n\t\t\t\t\t\t\tcolor:#203e5f;\n\t\t\t\t\t\t\tmargin-bottom: 10rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.text{\n\t\t\t\t\t\t\tpadding:20rpx 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t.progress{\n\t\t\theight: 8rpx;\n\t\t\twidth: 100%;\n\t\t\tbackground: #eee;\n\t\t\t.line{\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 0%;\n\t\t\t\tbackground: linear-gradient(to right,#BCE0FD,#74dbef);\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n.usePopup{\t\n\tpadding-top:15vh;\n\timage{\n\t\theight: 150rpx;\n\t\ttransform: translateY(100rpx);\n\t\topacity: 0;\n\t\tanimation: useanimate 1.5s infinite;\n\t}\n}\n\n@keyframes useanimate{\n\t0%{\n\t\ttransform: translateY(100rpx);\n\t\topacity: 0;\n\t}\n\t100%{\n\t\ttransform: translateY(-100rpx);\n\t\topacity: 1;\n\t}\n}\n</style>\n","import MiniProgramPage from 'C:/Users/DELL/Desktop/chickensoup/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCounterStore","ref","uniCloud","onReady","uni","showToast","errCode","computed","wx"],"mappings":"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"}