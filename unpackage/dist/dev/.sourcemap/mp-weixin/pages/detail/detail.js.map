{"version":3,"file":"detail.js","sources":["pages/detail/detail.vue","../前端资料/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGV0YWlsL2RldGFpbC52dWU"],"sourcesContent":["<template>\n\t<view class=\"detailLayout\" v-if=\"item\">\t\t\n\t    <z-paging ref=\"paging\" v-model=\"commentList\" @query=\"queryList\" empty-view-text=\"抢先回复\" empty-view-img=\"http://cdn.uviewui.com/uview/empty/comment.png\">\n\t\t\t\t\t\t\n\t\t\t<view class=\"soupDetail\">\n\t\t\t\t<soup-tab-group :type=\"item.soup_type\"></soup-tab-group>\n\t\t\t\t<soup-text-content :lookState=\"true\" :item=\"item\"></soup-text-content>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"bannerAd\">\n\t\t\t\t<ad unit-id=\"adunit-bf05c0a93b3fd0d2\"></ad>\n\t\t\t</view>\n\n\t\t\t<view class=\"comment\">\n\t\t\t\t<view class=\"list\" v-if=\"commentList.length\">\n\t\t\t\t\t<view class=\"row\" v-for=\"item in commentList\" :key=\"item._id\">\n\t\t\t\t\t\t<comment-item :item=\"item\" :subReply=\"true\"></comment-item>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view v-if=\"!commentList.length && !noData\" style=\"padding:60rpx\">\n\t\t\t\t\t<uni-load-more status=\"loading\" :showText=\"false\"></uni-load-more>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\n\t\t\t<template #bottom>\n\t\t\t\t<view class=\"interactive\">\n\t\t\t\t\t<interactive-bar :item=\"item\" :type=\"1\" @comment=\"handelComment\" \n\t\t\t\t\t@share=\"clickShare\"></interactive-bar>\n\t\t\t\t\t<view class=\"safe-area-bottom\"></view>\n\t\t\t\t</view>\n\t\t\t</template>\n\t\t\t\n\t\t</z-paging>\n\t</view>\n\n\t<uni-popup type=\"bottom\" ref=\"commentPopup\">\n\t\t<comment-reply ref=\"commentRef\" :source=\"source\" @success=\"replySuccess\"></comment-reply>\n\t</uni-popup>\n\t\n\t<share-posters ref=\"shareRef\" :info=\"shareInfo\"></share-posters>\n\n</template>\n\n<script setup>\n\timport {\n\t\tnextTick,\n\t\tref\n\t} from 'vue';\n\timport {\n\t\tonLoad\n\t} from \"@dcloudio/uni-app\"\nimport { showToast } from '../../utils/common';\n    const commentRef =ref(null);\n\tconst commentPopup = ref(null);\n\tconst source = ref({});\n\tconst db = uniCloud.database();\n\tconst dbCmd = db.command;\n\tconst $ = dbCmd.aggregate;\n\tconst item = ref();\n\tconst current_id = uniCloud.getCurrentUserInfo().uid;\n\tconst shareRef = ref(null)\n\tconst shareInfo = ref(null);\n\tconst commentList = ref([]);\n\tconst paging =ref(null);\n\tconst noData = ref(false);\n\tlet id;\n\tonLoad((e) => {\n\t\te.scene ? id = e.scene :id = e.id\t\t\n\t\tgetDetail();\n\t})\n\n\n\tuni.$on('commentLike',(e)=>{\n\t\tlet index = commentList.value.findIndex(item=>item._id == e._id);\n\t\tcommentList.value[index] = {\n\t\t\t...commentList.value[index],\n\t\t\t...e\n\t\t}\n\t})\n\t\n\tuni.$on(\"commentRemove\",()=>{\n\t\tnextTick(()=>{\n\t\t\tpaging.value.refresh();\n\t\t})\t\t\n\t})\n\n\tconst clickShare =(index)=>{\n\t\tshareInfo.value = item.value\n\t\tshareRef.value.handleShow();\n\t}\n\n\n\tconst queryList = (pageNo, pageSize)=>{\n\t\tgetComment(pageNo, pageSize)\n\t}\n\n\tconst getComment =async (pageNo, pageSize)=>{\n\t\tlet skip = (pageNo - 1) * pageSize;\n\t\tlet {result:{errCode,data}} = await db.collection(\"soup-comments\").aggregate()\n\t\t.match({\n\t\t\tsoup_id:id,\n\t\t\tcomment_type:0\n\t\t})\n\t\t.lookup({\n\t\t\tfrom: \"uni-id-users\",\n\t\t\tlet: {\n\t\t\t\tuid: '$user_id'\n\t\t\t},\n\t\t\tpipeline: $.pipeline().match(dbCmd.expr($.eq(['$_id', '$$uid']))).project({\n\t\t\t\tusername: 1,\n\t\t\t\tavatar: 1\n\t\t\t}).done(),\n\t\t\tas: \"userInfo\"\n\t\t})\n\t\t.lookup({\n\t\t\tfrom: \"soup-comments\",\n\t\t\tlet: {\n\t\t\t\tid: '$_id'\n\t\t\t},\n\t\t\tpipeline: $.pipeline().match(dbCmd.expr($.eq(['$reply_parent_id', '$$id'])))\n\t\t\t.count('length')\n\t\t\t.done(),\n\t\t\tas: \"childCount\"\n\t\t})\n\t\t.lookup({\n\t\t\tfrom: \"soup-comments\",\n\t\t\tlet: {\n\t\t\t\tid: '$_id'\n\t\t\t},\n\t\t\tpipeline: $.pipeline().match(dbCmd.expr($.eq(['$reply_parent_id', '$$id'])))\n\t\t\t.lookup({\n\t\t\t\tfrom: \"uni-id-users\",\n\t\t\t\tlet: {\n\t\t\t\t\tuid: '$user_id'\n\t\t\t\t},\n\t\t\t\tpipeline: $.pipeline().match(dbCmd.expr($.eq(['$_id',\n\t\t\t\t\t'$$uid'\n\t\t\t\t]))).project({\n\t\t\t\t\tusername: 1\n\t\t\t\t}).done(),\n\t\t\t\tas: 'userInfo'\n\t\t\t})\t\t\t\n\t\t\t.project({\n\t\t\t\tcomment_content: $.cond({\n\t\t\t\t\tif:$.eq(['$is_delete',true]),\n\t\t\t\t\tthen:\"已被删除\",\n\t\t\t\t\telse:'$comment_content'\n\t\t\t\t}),\n\t\t\t\tuserInfo:$.arrayElemAt(['$userInfo', 0])\n\t\t\t})\n\t\t\t.sort({\n\t\t\t\tlike_count:-1\n\t\t\t})\n\t\t\t.limit(2)\n\t\t\t.done(),\n\t\t\tas: \"child\"\n\t\t})\n\t\t.lookup({\n\t\t\tfrom: \"soup-like\",\n\t\t\tlet: {\n\t\t\t\tcommentID: '$_id'\n\t\t\t},\n\t\t\tpipeline: $.pipeline().match(\t\t\t\t\n\t\t\tdbCmd.expr(\n\t\t\t\t$.and([\t\t\t\t\t\n\t\t\t\t\t$.eq([id,'$soup_id']),\n\t\t\t\t\t$.eq(['$$commentID','$comment_id']),\n\t\t\t\t\t$.eq(['$user_id',current_id])\n\t\t\t\t])\n\t\t\t)).count('length')\n\t\t\t.done(),\n\t\t\tas: \"likeState\"\n\t\t})\n\t\t.sort({comment_date:-1})\n\t\t.skip(skip)\n\t\t.limit(pageSize)\n\t\t.project({\t\n\t\t\tis_delete:1,\n\t\t\tisLike:$.cond({\n\t\t\t\tif:$.gt([$.arrayElemAt(['$likeState.length',0]),0]),\n\t\t\t\tthen:true,\n\t\t\t\telse:false\n\t\t\t}),\n\t\t\tchild:1,\n\t\t\tchildCount:$.arrayElemAt(['$childCount.length', 0]),\n\t\t\tlike_count: 1,\n\t\t\tcomment_count: 1,\n\t\t\tcomment_type: 1,\n\t\t\tcomment_content: $.cond({\n\t\t\t\tif:$.eq(['$is_delete',true]),\n\t\t\t\tthen:\"已被删除\",\n\t\t\t\telse:'$comment_content'\n\t\t\t}),\n\t\t\tsoup_id: 1,\n\t\t\tcomment_date: 1,\n\t\t\tuserInfo: $.arrayElemAt(['$userInfo', 0])\n\t\t})\n\t\t.end();\n\t\tpaging.value.complete(data)\n\t\tif(data.length==0) noData.value = true;\n\t\tconsole.log(data);\n\t}\n\t\n\t\n\tconst replySuccess = ()=>{\n\t\tshowToast(\"发布成功\");\n\t\tcommentPopup.value.close();\n\t\tpaging.value.refresh();\n\t}\n\n\tconst getDetail = async () => {\n\t\tlet {\n\t\t\tresult: {\n\t\t\t\terrCode,\n\t\t\t\tdata\n\t\t\t}\n\t\t} = await db.collection(\"soup-chicken\").aggregate()\n\t\t\t.match({\n\t\t\t\tstatus: 1,\n\t\t\t\tis_delete: dbCmd.neq(true),\n\t\t\t\t_id:id\n\t\t\t})\t\t\t\n\t\t\t.lookup({\n\t\t\t\tfrom: \"uni-id-users\",\n\t\t\t\tlet: {\n\t\t\t\t\tuid: '$user_id'\n\t\t\t\t},\n\t\t\t\tpipeline: $.pipeline().match(dbCmd.expr($.eq(['$_id', '$$uid']))).project({\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tavatar: 1\n\t\t\t\t}).done(),\n\t\t\t\tas: \"userInfo\"\n\t\t\t})\n\t\t\t.lookup({\n\t\t\t\tfrom: \"soup-like\",\n\t\t\t\tlet: {\n\t\t\t\t\tsoupID: '$_id'\n\t\t\t\t},\n\t\t\t\tpipeline: $.pipeline().match(\t\t\t\t\n\t\t\t\tdbCmd.expr(\n\t\t\t\t\t$.and([\n\t\t\t\t\t\t$.eq(['$like_type', 0]),\n\t\t\t\t\t\t$.eq(['$$soupID','$soup_id']),\n\t\t\t\t\t\t$.eq(['$user_id',current_id])\n\t\t\t\t\t])\n\t\t\t\t)).count('length')\n\t\t\t\t.done(),\n\t\t\t\tas: \"likeState\"\n\t\t\t})\n\t\t\t.project({\n\t\t\t\tisLike:$.cond({\n\t\t\t\t\tif:$.gt([$.arrayElemAt(['$likeState.length',0]),0]),\n\t\t\t\t\tthen:true,\n\t\t\t\t\telse:false\n\t\t\t\t}),\n\t\t\t\tcollect_count: 1,\n\t\t\t\tcomment_count: 1,\n\t\t\t\tcontent: 1,\n\t\t\t\tfrom: 1,\n\t\t\t\tlike_count: 1,\n\t\t\t\tsoup_type: 1,\n\t\t\t\tview_count: 1,\n\t\t\t\tuserInfo: $.arrayElemAt(['$userInfo', 0])\n\t\t\t})\n\t\t\t.end()\n\n\t\tif (errCode != 0) return showToast(\"信息有误，请重新刷新\", \"none\");\n\t\tconsole.log(data);\n\t\titem.value = data[0];\n\t\tsource.value = {\n\t\t\tsoup_id:item.value._id,\n\t\t\tcomment_type:0\n\t\t}\n\t}\n\n\n\n\tconst handelComment = () => {\n\t\tcommentPopup.value.open();\n\t\tcommentRef.value.focusFn();\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.soupDetail {\n\t\tpadding: 50rpx 30rpx;\n\t\tborder-bottom: 12rpx solid #F7F7F7;\n\t}\n\t.bannerAd{\n\t\tborder-bottom: 12rpx solid #F7F7F7;\n\t}\n\t.comment {\n\t\t\n\t}\n\n\t.interactive {\t\t\n\t\twidth: 100%;\t\t\n\t\tbackground: #fff;\n\t\tborder-top: 1px solid #e4e4e4;\n\t}\n</style>","import MiniProgramPage from 'C:/Users/DELL/Desktop/chickensoup/pages/detail/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","onLoad","uni","item","nextTick","showToast"],"mappings":"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"}