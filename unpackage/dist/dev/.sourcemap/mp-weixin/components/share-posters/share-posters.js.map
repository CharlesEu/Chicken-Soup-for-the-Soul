{"version":3,"file":"share-posters.js","sources":["components/share-posters/share-posters.vue","../前端资料/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvREVMTC9EZXNrdG9wL2NoaWNrZW5zb3VwL2NvbXBvbmVudHMvc2hhcmUtcG9zdGVycy9zaGFyZS1wb3N0ZXJzLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"layout\" v-if=\"isShow\">\n\t\t<l-painter hidden ref=\"poster\" :after-delay=\"200\" css=\"width:750rpx; height: 1163rpx; background-image: url(https://mp-293d9e23-9bcc-4a7d-86ad-51eac2183ed9.cdn.bspapp.com/cloudstorage/shareBg.jpg);\" \n\t\tcustom-style=\"position: fixed; top:0;left:0%;\">\n\t\t\t<l-painter-view css=\"width: 600rpx;position: absolute; top:300rpx;left:82rpx\">\n\t\t\t\t<l-painter-text css=\"font-size: 46rpx; line-height: 1.7em;line-clamp:6\" \n\t\t\t\t:text=\"info.content\"></l-painter-text>\n\t\t\t\t\n\t\t\t\t<l-painter-view css=\"margin-top:40rpx\">\n\t\t\t\t\t<l-painter-image :src=\"info.userInfo.avatar || '../../static/images/defAvatar.png'\" css=\"width: 50rpx; height: 50rpx; border-radius: 50%; object-fit: cover; object-position: 50% 50%;\"></l-painter-image>\n\t\t\t\t\t<l-painter-text :text=\"info.userInfo.username\" css=\"font-size: 30rpx;margin-left: 10rpx;line-height:50rpx;color:#555\"></l-painter-text>\n\t\t\t\t</l-painter-view>\n\t\t\t\t\n\t\t\t</l-painter-view>\t\n\t\t\t\t\t\n\t\t\t<l-painter-text :text=\"`—— 来自：${userStore.userInfo.username}的分享 ——`\" css=\"position: absolute; top:850rpx; left: 0; width:100%; text-align: center; font-size: 26rpx; color:#bbb\"></l-painter-text>\n\t\t\t\n\t\t\t<l-painter-image :src=\"QRPicPath\" css=\"position: absolute; width: 145rpx; height: 145rpx; left: 82rpx; top:955rpx;object-fit: cover;\"></l-painter-image>\n\t\t</l-painter>\n\t</view>\n\t<view style=\" \"></view>\n\t<!-- ../../static/images/loadingPic.jpg -->\n\t<uni-popup ref=\"popup\" mask-background-color=\"rgba(0,0,0,0.7)\">\t\t\n\t\t<view class=\"shareLayout\">\n\t\t\t<image class=\"pic\" :src=\"sharePathUrl\" mode=\"widthFix\"></image>\n\t\t\t<view class=\"saveAlbum\" @click=\"onSaveAlbum\">点击保存至相册</view>\n\t\t</view>\t\n\t</uni-popup>\n</template>\n\n<script setup>\nimport { nextTick, onMounted, ref } from 'vue';\nimport {useUserStore} from \"@/stores/user.js\"\nconst QRCode = uniCloud.importObject(\"QRCode\");\nconst userStore = useUserStore()\nconst popup = ref(null);\nconst poster = ref(null);\nconst sharePathUrl =ref();\nconst isShow = ref(false);\nconst QRPicPath = ref()\n\nconst props = defineProps({\n\tinfo:{\n\t\ttype:Object,\n\t\tdefault(){\n\t\t\treturn {}\n\t\t}\n\t}\n})\n\nconst handleShow = ()=>{\n\tuni.showLoading({\n\t\ttitle:\"加载中...\"\n\t})\n\tisShow.value = true;\n\tnextTick(()=>{\n\t\tshowPopup();\n\t})\t\n}\n\n\nconst showPopup =async ()=>{\n\tlet code =await QRCode.getUnlimited({page:'pages/detail/detail',scene:props.info._id})\n\tQRPicPath.value =code\t\n\t\n\tnextTick(()=>{\t\t\t\n\t\tposter.value.canvasToTempFilePathSync({\n\t\t\tfileType:\"jpg\",\n\t\t\tpathType:'url',\n\t\t\tquality: 0.6,\n\t\t\tsuccess:res=>{\n\t\t\t\tconsole.log(res)\n\t\t\t\tsharePathUrl.value = res.tempFilePath\n\t\t\t\tpopup.value.open();\n\t\t\t\tuni.hideLoading();\n\t\t\t},\n\t\t\tfail:err=>{\n\t\t\t\tuni.hideLoading();\n\t\t\t\tshowToast(err)\n\t\t\t}\n\t\t})\n\t})\n}\n\n\n\n//点击保存到相册\nconst onSaveAlbum = ()=>{\t\t\n\ttry {\t\n\t\tuni.showLoading({\n\t\t\ttitle: \"下载中...\",\n\t\t\tmask: true\n\t\t})\t\t\t\t\n\t\tuni.getImageInfo({\n\t\t\tsrc: sharePathUrl.value,\n\t\t\tsuccess: (res) => {\n\t\t\t\tuni.saveImageToPhotosAlbum({\n\t\t\t\t\tfilePath: res.path,\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tpopup.value.close();\n\t\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: \"保存成功，请到相册查看\",\n\t\t\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t},500)\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t},\n\t\t\t\t\tfail: err => {\n\t\t\t\t\t\tif (err.errMsg == 'saveImageToPhotosAlbum:fail cancel') {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '保存失败，请重新点击下载',\n\t\t\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\ttitle: \"授权提示\",\n\t\t\t\t\t\t\tcontent: \"需要授权保存相册\",\n\t\t\t\t\t\t\tsuccess: res => {\n\t\t\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t\t\tuni.openSetting({\n\t\t\t\t\t\t\t\t\t\tsuccess: (setting) => {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t\t\t\t\tsetting);\n\t\t\t\t\t\t\t\t\t\t\tif (setting\n\t\t\t\t\t\t\t\t\t\t\t\t.authSetting[\n\t\t\t\t\t\t\t\t\t\t\t\t\t'scope.writePhotosAlbum'\n\t\t\t\t\t\t\t\t\t\t\t\t\t]) {\n\t\t\t\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: \"获取授权成功\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: \"获取权限失败\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\n\t\t\t}\n\t\t})\n\t\n\t} catch (err) {\n\t\tconsole.log(err);\n\t\tuni.hideLoading();\n\t}\t\n}\n\n\n\n\ndefineExpose({\n\tshowPopup,\n\thandleShow\n})\n\n</script>\n\n<style lang=\"scss\" scoped>\n.shareLayout{\n\twidth: 600rpx;\n\t.pic{\n\t\twidth: 100%;\n\t\tdisplay: block;\n\t\tborder-radius: 30rpx;\n\t}\n\t.saveAlbum{\n\t\twidth: 100%;\n\t\theight: 80rpx;\n\t\tbackground: #2A9D8E;\n\t\tcolor:#fff;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 36rpx;\n\t\tmargin:0 auto;\n\t\tmargin-top:30rpx;\n\t\tborder-radius: 80rpx;\n\t}\n}\n</style>","import Component from 'C:/Users/DELL/Desktop/chickensoup/components/share-posters/share-posters.vue'\nwx.createComponent(Component)"],"names":["uniCloud","useUserStore","ref","uni","nextTick","res"],"mappings":"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"}