{"version":3,"file":"comment-item.js","sources":["components/comment-item/comment-item.vue","../前端资料/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvREVMTC9EZXNrdG9wL2NoaWNrZW5zb3VwL2NvbXBvbmVudHMvY29tbWVudC1pdGVtL2NvbW1lbnQtaXRlbS52dWU"],"sourcesContent":["<template>\n\t<view class=\"commentItem\">\n\t\t<view class=\"outer\">\n\t\t\t<view class=\"avatar\">\n\t\t\t\t<image class=\"pic\" :src=\"commentItem.userInfo.avatar || '../../static/images/defAvatar.png'\" mode=\"\"></image>\n\t\t\t</view>\n\t\t\t<view class=\"content\">\n\t\t\t\t<view class=\"userinfo\">\n\t\t\t\t\t<view class=\"left\">\n\t\t\t\t\t\t<view class=\"name\">{{commentItem.userInfo.username}}</view>\n\t\t\t\t\t\t<view class=\"time\">\n\t\t\t\t\t\t\t<uni-dateformat :date=\"commentItem.comment_date\" :threshold=\"[60000, 3600000]\" format=\"yyyy/MM/dd hh:mm\"></uni-dateformat>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"right\">\n\t\t\t\t\t\t<view class=\"like\" @click=\"clickLike\">\n\t\t\t\t\t\t\t<view class=\"num\" v-if=\"commentItem.like_count>0\"\n\t\t\t\t\t\t\t:style=\"{color:commentItem.isLike?'#dd524d':'#a7a7a7'}\"\n\t\t\t\t\t\t\t>{{commentItem.like_count}}</view>\n\t\t\t\t\t\t\t<uni-icons v-if=\"!commentItem.isLike\" type=\"hand-up\" size=\"20\" color=\"#a7a7a7\"></uni-icons>\n\t\t\t\t\t\t\t<uni-icons v-else type=\"hand-up-filled\" size=\"20\" color=\"#dd524d\"></uni-icons>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"remove\" \n\tv-if=\"!toplevel && !commentItem.is_delete && (commentItem.userInfo._id == current_id || isAdminRole())\"\n\t\t\t\t\t\t@click=\"commentRemove\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<uni-icons type=\"trash\" size=\"20\" color=\"#a7a7a7\"></uni-icons>\n\t\t\t\t\t\t\t<text>删除</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"reply\" @click=\"goReply\">\n\t\t\t\t\t<text :class=\"commentItem.is_delete?'isDelete':''\">{{commentItem.comment_content}}</text> \n\t\t\t\t\t<text class=\"text\" v-if=\"commentItem.replyInfo\">\n\t\t\t\t\t\t// 回复 <text class=\"nickname\">@{{commentItem.replyInfo.userInfo.username}}</text>：{{commentItem.replyInfo.comment_content}}\n\t\t\t\t\t</text>\n\t\t\t\t\t\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\n\t\t<view class=\"subReply\" v-if=\"subReply && commentItem.childCount\" @click=\"goReply\">\n\t\t\t<view class=\"list\">\n\t\t\t\t<view class=\"row\" v-for=\"row in commentItem.child\" :key=\"row._id\">\n\t\t\t\t\t{{row.userInfo.username}}：{{row.comment_content}}</view>\t\t\t\t\n\t\t\t\t<view class=\"row more\">共{{commentItem.childCount}}条回复 \n\t\t\t\t\t<uni-icons type=\"right\" color=\"#a7a7a7\" size=\"16\"></uni-icons>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport {ref,watch} from \"vue\";\nimport debounce from \"lodash.debounce\"\nimport { isAdminRole } from \"../../utils/common\";\nconst db = uniCloud.database();\nconst current_id = ref(uniCloud.getCurrentUserInfo().uid);\n\nconst emits = defineEmits(['reply']);\nconst props = defineProps({\n\tsubReply:{\n\t\ttype:Boolean,\n\t\tdefault:false\n\t},\n\titem:Object,\n\treply:{\n\t\ttype:Boolean,\n\t\tdefault:false\n\t},\n\ttoplevel:{\n\t\ttype:Boolean,\n\t\tdefault:false\n\t}\n})\n\nconst commentItem = ref(props.item);\n\nwatch(()=>props.item,(nv)=>{\n\tcommentItem.value = nv;\n})\n\n//删除评论\nconst commentRemove = async()=>{\n\tlet result = await uni.showModal({\n\t\ttitle:\"是否删除\"\n\t})\n\tif(!result.confirm) return;\t\n\tlet {result:{errCode}} = await db.collection(\"soup-comments\").doc(commentItem.value._id).update({\n\t\tis_delete:true\n\t})\n\tif(errCode == 0) uni.$emit(\"commentRemove\");\n\t\n}\n\n\n\n//点赞\nconst clickLike = debounce(handleLike,1000,{'leading': true,'trailing': false})\n\n\nasync function handleLike(){\n\tif(commentItem.value.isLike){\n\t\tcommentItem.value.like_count--\n\t\tdb.collection(\"soup-like\").where({\n\t\t\tsoup_id:commentItem.value.soup_id,\n\t\t\tcomment_id:commentItem.value._id,\n\t\t\tuser_id:current_id.value,\n\t\t\tlike_type:1\n\t\t}).remove();\n\t}else{\n\t\tcommentItem.value.like_count++\n\t\tdb.collection(\"soup-like\").add({\n\t\t\tsoup_id:commentItem.value.soup_id,\n\t\t\tcomment_id:commentItem.value._id,\n\t\t\tlike_type:1\n\t\t})\n\t}\n\tcommentItem.value.isLike = !commentItem.value.isLike\n\tuni.$emit('commentLike',{_id:commentItem.value._id,isLike:commentItem.value.isLike,like_count:commentItem.value.like_count})\n}\n\n\n\n//点击回复\nconst goReply = ()=>{\n\tif(props.subReply){\n\t\tuni.navigateTo({\n\t\t\turl:\"/pages/detail/reply\"\n\t\t})\n\t\tuni.setStorageSync(\"currentReply\",props.item);\n\t}\t\n\tif(props.reply){\t\t\n\t\temits(\"reply\",props.item)\n\t}\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.isDelete{\n\ttext-decoration: line-through;\n\tcolor:$text-font-color-3;\n}\n.commentItem{\n\tpadding:30rpx;\n\t.outer{\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: flex-start;\n\t\t.avatar{\n\t\t\twidth: 60rpx;\n\t\t\theight:60rpx;\n\t\t\tmargin-right: 20rpx;\n\t\t\tborder-radius: 50%;\n\t\t\toverflow: hidden;\n\t\t\t.pic{\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\t\t.content{\n\t\t\tflex:1;\n\t\t\t.userinfo{\n\t\t\t\theight: 60rpx;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\t.left{\n\t\t\t\t\t.name{\n\t\t\t\t\t\tfont-size: 26rpx;\n\t\t\t\t\t\tcolor:$text-font-color-2;\n\t\t\t\t\t}\n\t\t\t\t\t.time{\n\t\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\t\tcolor:$text-font-color-3;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t.right{\n\t\t\t\t\tcolor:$text-font-color-3;\n\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\t.like{\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t.num{\n\t\t\t\t\t\t\tmargin-right: 5rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t.remove{\n\t\t\t\t\t\tmargin-left:20rpx;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t.reply{\n\t\t\t\tpadding:20rpx 0;\n\t\t\t\tfont-size: 30rpx;\n\t\t\t\tcolor:$text-font-color-1;\n\t\t\t\tline-height: 1.7em;\n\t\t\t\t.text{\n\t\t\t\t\tcolor:$text-font-color-3;\n\t\t\t\t\t.nickname{\n\t\t\t\t\t\tcolor:$brand-theme-color;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t}\n\t}\n\t.subReply{\n\t\tpadding-left:80rpx;\n\t\t.list{\n\t\t\tbackground: #f4f4f4;\n\t\t\tpadding:20rpx;\n\t\t\tborder-radius: 10rpx;\n\t\t\t.row{\n\t\t\t\tline-height: 1.8em;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tcolor:$text-font-color-2;\n\t\t\t}\n\t\t\t.more{\n\t\t\t\tcolor:$text-font-color-3;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>","import Component from 'C:/Users/DELL/Desktop/chickensoup/components/comment-item/comment-item.vue'\nwx.createComponent(Component)"],"names":["uniCloud","ref","watch","uni","debounce"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA,UAAM,KAAKA,cAAAA,GAAS;AACpB,UAAM,aAAaC,cAAAA,IAAID,cAAAA,GAAS,mBAAoB,EAAC,GAAG;AAExD,UAAM,QAAQ;AACd,UAAM,QAAQ;AAgBd,UAAM,cAAcC,cAAG,IAAC,MAAM,IAAI;AAElCC,kBAAK,MAAC,MAAI,MAAM,MAAK,CAAC,OAAK;AAC1B,kBAAY,QAAQ;AAAA,IACrB,CAAC;AAGD,UAAM,gBAAgB,YAAS;AAC9B,UAAI,SAAS,MAAMC,cAAG,MAAC,UAAU;AAAA,QAChC,OAAM;AAAA,MACR,CAAE;AACD,UAAG,CAAC,OAAO;AAAS;AACpB,UAAI,EAAC,QAAO,EAAC,QAAO,EAAC,IAAI,MAAM,GAAG,WAAW,eAAe,EAAE,IAAI,YAAY,MAAM,GAAG,EAAE,OAAO;AAAA,QAC/F,WAAU;AAAA,MACZ,CAAE;AACD,UAAG,WAAW;AAAGA,sBAAG,MAAC,MAAM,eAAe;AAAA,IAE3C;AAKA,UAAM,YAAYC,cAAAA,SAAS,YAAW,KAAK,EAAC,WAAW,MAAK,YAAY,MAAK,CAAC;AAG9E,mBAAe,aAAY;AAC1B,UAAG,YAAY,MAAM,QAAO;AAC3B,oBAAY,MAAM;AAClB,WAAG,WAAW,WAAW,EAAE,MAAM;AAAA,UAChC,SAAQ,YAAY,MAAM;AAAA,UAC1B,YAAW,YAAY,MAAM;AAAA,UAC7B,SAAQ,WAAW;AAAA,UACnB,WAAU;AAAA,QACb,CAAG,EAAE,OAAM;AAAA,MACX,OAAM;AACJ,oBAAY,MAAM;AAClB,WAAG,WAAW,WAAW,EAAE,IAAI;AAAA,UAC9B,SAAQ,YAAY,MAAM;AAAA,UAC1B,YAAW,YAAY,MAAM;AAAA,UAC7B,WAAU;AAAA,QACb,CAAG;AAAA,MACD;AACD,kBAAY,MAAM,SAAS,CAAC,YAAY,MAAM;AAC9CD,oBAAG,MAAC,MAAM,eAAc,EAAC,KAAI,YAAY,MAAM,KAAI,QAAO,YAAY,MAAM,QAAO,YAAW,YAAY,MAAM,WAAU,CAAC;AAAA,IAC5H;AAKA,UAAM,UAAU,MAAI;AACnB,UAAG,MAAM,UAAS;AACjBA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAI;AAAA,QACP,CAAG;AACDA,sBAAAA,MAAI,eAAe,gBAAe,MAAM,IAAI;AAAA,MAC5C;AACD,UAAG,MAAM,OAAM;AACd,cAAM,SAAQ,MAAM,IAAI;AAAA,MACxB;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvIA,GAAG,gBAAgB,SAAS;"}